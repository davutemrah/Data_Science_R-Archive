---
title: "R Notebook"
output: html_notebook
---
## data.table package

* written in C so it is much faster
* subsetting, grouping and updating is much faster
* install data.table package

```{r, message=FALSE}
library(data.table)
# large informative message
```

```{r}
df = data.frame(x=rnorm(n=9), 
                y= rep(c("a", "b", "c"), each=3),
                z=rnorm(n=9))
head(df, 3)
```
# with using data.table
```{r}
dt = data.table(x = rnorm(n=9),
                 y = rep(c("a", "b", "c"), each=3), 
                 z = rnorm(n=9))
head(dt, 3)
```
# see the data tables in memory
```{r}
tables()
```
# Subsetting
```{r}
# second row and all columns
dt[2, ]
```
```{r}
# subsetting all columns where y equals "a"
dt[dt$y=="a", ]
```
```{r}
# second and third row
dt[c(2, 3)]
```
# subsetting columns
```{r}
dt[, c(2, 3)]
```
# calculating values for variables with expressions
```{r}
dt[, list(mean(x), sum(z))]
```

```{r}
dt[, table(y) ]
```
# Adding new columns
```{r}
dt[, w := z^2]

head(dt, 3)
```
# Assigning / Copying data tables

Be careful!! I assigned dt to dt2 (copied)

After that, I made a change in dt; but that change automatically shows up in dt2 , as well.

When I use copy function, it just copied
```{r}
dt2 <- dt      # assign data table

dt3 <- copy(dt)  # just copying data table

head(dt, 2)
```
```{r}
dt[, y := 2]

head(dt, 2)
```
```{r}
head(dt2, 2)
```
```{r}
head(dt3, 2)
```
# multiple operations

* assigning new variable m
* step1: new var tmp, equals to x + z
* step2: take log2 
* value of last statement will be assigned to m

```{r}
dt[, m:= {tmp <- (x + z); log2(tmp + 5)}]
```

# plyr like operations
```{r}
# creating a new var a; boolean, true if x is positive
dt[, a := x > 0]
```

```{r}
# group by a variable
# mean by TRUE, and FALSE
dt[ , b := mean(x + w), by = a]
```

# Special Variables
.N : counting  the cases

1E5 : 10^5 = 100.000

```{r}
#
set.seed(123);
dt <- data.table(x = sample(letters[1:3], 1E5, TRUE))

# counting the cases by group
dt[, .N, by = x]
```

```{r}
dt <- data.table(x = rep(c("a", "b", "c"), each = 100), 
                 y = rnorm(n=300))

# setkey is sorting and setting the key so that subsetting will be faster. setkey is a must indeed.
setkey(dt, x)

dt['a']  # subsetting with value in key variable x
```

# joins
```{r}
dt1 <- data.table(x = c('a', 'a', 'b', 'dt1'), y = 1:4)
dt2 <- data.table(x = c('a', 'b', 'dt2'), z = 5:7)

setkey(dt1, x); setkey(dt2, x)

merge(dt1, dt2)  # only matched rows are kept
```
# Fast reading
```{r}
big_df <- data.frame(x = rnorm(1E6), y = rnorm(1E6))

file <- tempfile()
```


```{r}
write.table(big_df, file=file, row.names = FALSE,
            col.names = TRUE, sep = "\t", 
            quote = FALSE)
```


```{r}
system.time(fread(file)) # fread reads tables
```
```{r}
system.time(read.table(file, header = TRUE, sep = "\t"))
```









